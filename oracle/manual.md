# dockerコンテナ削除
```
docker ps -qa | xargs -I@ bash -c 'docker stop @ && docker rm @'
```

# Dockerfileよりイメージ作成
```
time docker build -t centos_oracle . | tee log
```

# dockerイメージ削除
```
docker images | awk '$1=="<none>"{print $3}' | xargs -I@ docker rmi @
```

# dockerコンテナ起動
```
docker run --privileged -v /etc/localtime:/etc/localtime -p 28787:8787 -p 21521:1521 -p 25500:5500 -itd --name oracle --shm-size=8g centos_oracle /sbin/init
```

# dockerコンテナ潜入

```
docker exec --user root -it oracle /bin/bash
```

# コンテナ起動後データベース作成
実行スクリプトのうち下記を修正してから、実行
## 追加
export PASSWORD=ORACLE_PWD

## 変更前
```
$SU -s /bin/bash  $ORACLE_OWNER -c "$DBCA -silent -createDatabase -gdbName $ORACLE_SID -templateName $TEMPLATE_NAME -characterSet $CHARSET -createAsContainerDatabase $CREATE_AS_CDB -numberOfPDBs $NUMBER_OF_PDBS -pdbName $PDB_NAME -createListener $LISTENER_NAME:$LISTENER_PORT -datafileDestination $ORACLE_DATA_LOCATION -sid $ORACLE_SID -autoGeneratePasswords -emConfiguration DBEXPRESS -emExpressPort $EM_EXPRESS_PORT"
```
## 変更後
```
$SU -s /bin/bash  $ORACLE_OWNER -c "$DBCA -silent -createDatabase -gdbName $ORACLE_SID -templateName $TEMPLATE_NAME -characterSet $CHARSET -createAsContainerDatabase $CREATE_AS_CDB -numberOfPDBs $NUMBER_OF_PDBS -pdbName $PDB_NAME -pdbAdminPassword $PASSWORD -createListener $LISTENER_NAME:$LISTENER_PORT -datafileDestination $ORACLE_DATA_LOCATION -sid $ORACLE_SID -sysPassword $PASSWORD -systemPassword $PASSWORD -emConfiguration DBEXPRESS -emExpressPort $EM_EXPRESS_PORT"
```
14分ぐらい
```
[root@be807f28f5bd /]$time /etc/init.d/oracledb_ORCLCDB-19c configure | tee log
```

# /opt/oracle/product/19c/dbhome_1/network/admin/listener.oraの設定はdbca実行後そのまま
```
[oracle@be807f28f5bd /]$cat /opt/oracle/product/19c/dbhome_1/network/admin/listener.ora
# listener.ora Network Configuration File: /opt/oracle/product/19c/dbhome_1/network/admin/listener.ora
# Generated by Oracle configuration tools.

LISTENER =
  (DESCRIPTION_LIST =
    (DESCRIPTION =
      (ADDRESS = (PROTOCOL = TCP)(HOST = be807f28f5bd)(PORT = 1521))
      (ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC1521))
    )
  )
```

# CDBよりSEEDファイルをもとにPDBを複製
sqldeveloperより実施
![](./1.png)
## 起動とオープン
```
set serveroutput on
set timing on
begin
    for i in 1..12 loop
        begin
            dbms_output.put_line('create pluggable database orclpdb'||lpad(i,2,0)||' admin user pdb'||lpad(i,2,0)||' identified by oracle_pwd roles = (dba) file_name_convert = ('||''''||'/opt/oracle/oradata/ORCLCDB/pdbseed'||''''||','||''''||'/opt/oracle/oradata/ORCLCDB/pdb'||lpad(i,2,0)||''''||')'); 
            execute immediate 'create pluggable database orclpdb'||lpad(i,2,0)||' admin user pdb'||lpad(i,2,0)||' identified by oracle_pwd roles = (dba) file_name_convert = ('||''''||'/opt/oracle/oradata/ORCLCDB/pdbseed'||''''||','||''''||'/opt/oracle/oradata/ORCLCDB/pdb'||lpad(i,2,0)||''''||')';
            dbms_output.put_line('alter pluggable database orclpdb'||lpad(i,2,0)||' open read write');
            execute immediate 'alter pluggable database orclpdb'||lpad(i,2,0)||' open read write';
            exception when others then dbms_output.put_line('[ '|| sqlcode||']'||sqlerrm);
        end;
    end loop;
end;
/
create pluggable database orclpdb01 admin user pdb1 identified by oracle_pwd roles = (dba) file_name_convert = ('/opt/oracle/oradata/ORCLCDB/pdbseed','/opt/oracle/oradata/ORCLCDB/pdb1')
alter pluggable database orclpdb01 open read write
create pluggable database orclpdb02 admin user pdb2 identified by oracle_pwd roles = (dba) file_name_convert = ('/opt/oracle/oradata/ORCLCDB/pdbseed','/opt/oracle/oradata/ORCLCDB/pdb2')
alter pluggable database orclpdb02 open read write
create pluggable database orclpdb03 admin user pdb3 identified by oracle_pwd roles = (dba) file_name_convert = ('/opt/oracle/oradata/ORCLCDB/pdbseed','/opt/oracle/oradata/ORCLCDB/pdb3')
alter pluggable database orclpdb03 open read write
create pluggable database orclpdb04 admin user pdb4 identified by oracle_pwd roles = (dba) file_name_convert = ('/opt/oracle/oradata/ORCLCDB/pdbseed','/opt/oracle/oradata/ORCLCDB/pdb4')
alter pluggable database orclpdb04 open read write
create pluggable database orclpdb05 admin user pdb5 identified by oracle_pwd roles = (dba) file_name_convert = ('/opt/oracle/oradata/ORCLCDB/pdbseed','/opt/oracle/oradata/ORCLCDB/pdb5')
alter pluggable database orclpdb05 open read write
create pluggable database orclpdb06 admin user pdb6 identified by oracle_pwd roles = (dba) file_name_convert = ('/opt/oracle/oradata/ORCLCDB/pdbseed','/opt/oracle/oradata/ORCLCDB/pdb6')
alter pluggable database orclpdb06 open read write
create pluggable database orclpdb07 admin user pdb7 identified by oracle_pwd roles = (dba) file_name_convert = ('/opt/oracle/oradata/ORCLCDB/pdbseed','/opt/oracle/oradata/ORCLCDB/pdb7')
alter pluggable database orclpdb07 open read write
create pluggable database orclpdb08 admin user pdb8 identified by oracle_pwd roles = (dba) file_name_convert = ('/opt/oracle/oradata/ORCLCDB/pdbseed','/opt/oracle/oradata/ORCLCDB/pdb8')
alter pluggable database orclpdb08 open read write
create pluggable database orclpdb09 admin user pdb9 identified by oracle_pwd roles = (dba) file_name_convert = ('/opt/oracle/oradata/ORCLCDB/pdbseed','/opt/oracle/oradata/ORCLCDB/pdb9')
alter pluggable database orclpdb09 open read write
create pluggable database orclpdb10 admin user pdb10 identified by oracle_pwd roles = (dba) file_name_convert = ('/opt/oracle/oradata/ORCLCDB/pdbseed','/opt/oracle/oradata/ORCLCDB/pdb10')
alter pluggable database orclpdb10 open read write
create pluggable database orclpdb11 admin user pdb11 identified by oracle_pwd roles = (dba) file_name_convert = ('/opt/oracle/oradata/ORCLCDB/pdbseed','/opt/oracle/oradata/ORCLCDB/pdb11')
alter pluggable database orclpdb11 open read write
create pluggable database orclpdb12 admin user pdb12 identified by oracle_pwd roles = (dba) file_name_convert = ('/opt/oracle/oradata/ORCLCDB/pdbseed','/opt/oracle/oradata/ORCLCDB/pdb12')
alter pluggable database orclpdb12 open read write


PL/SQLプロシージャが正常に完了しました。

経過時間: 00:00:46.843
```
## 停止と削除
```
set serveroutput on
set timing on
begin
    for i in 1..12 loop
        begin
            dbms_output.put_line('alter pluggable database orclpdb'||lpad(i,2,0)||' close immediate');
            execute immediate 'alter pluggable database orclpdb'||lpad(i,2,0)||' close immediate';
            dbms_output.put_line('drop pluggable database orclpdb'||lpad(i,2,0)||' including datafiles');
            execute immediate 'drop pluggable database orclpdb'||lpad(i,2,0)||' including datafiles';
            exception when others then dbms_output.put_line('[ '|| sqlcode||']'||sqlerrm);
        end;
    end loop;
end;
/
alter pluggable database orclpdb01 close immediate
drop pluggable database orclpdb01 including datafiles
alter pluggable database orclpdb02 close immediate
drop pluggable database orclpdb02 including datafiles
alter pluggable database orclpdb03 close immediate
drop pluggable database orclpdb03 including datafiles
alter pluggable database orclpdb04 close immediate
drop pluggable database orclpdb04 including datafiles
alter pluggable database orclpdb05 close immediate
drop pluggable database orclpdb05 including datafiles
alter pluggable database orclpdb06 close immediate
drop pluggable database orclpdb06 including datafiles
alter pluggable database orclpdb07 close immediate
drop pluggable database orclpdb07 including datafiles
alter pluggable database orclpdb08 close immediate
drop pluggable database orclpdb08 including datafiles
alter pluggable database orclpdb09 close immediate
drop pluggable database orclpdb09 including datafiles
alter pluggable database orclpdb10 close immediate
drop pluggable database orclpdb10 including datafiles
alter pluggable database orclpdb11 close immediate
drop pluggable database orclpdb11 including datafiles
alter pluggable database orclpdb12 close immediate
drop pluggable database orclpdb12 including datafiles


PL/SQLプロシージャが正常に完了しました。

経過時間: 00:00:10.755
```

# sqldeveloperより接続確認
サービス名は大文字小文字を区別しなさそう。
![](./2.png)
![](./3.png)

# /opt/oracle/product/19c/dbhome_1/network/admin/tnsnames.oraの作成
sqlplusからもサービス名で接続できるように以下のシェルでサービス数分書き込む。
## 変更前
```
[oracle@be807f28f5bd /opt/oracle/product/19c/dbhome_1/network/admin]$cat /opt/oracle/product/19c/dbhome_1/network/admin/tnsnames.ora
# tnsnames.ora Network Configuration File: /opt/oracle/product/19c/dbhome_1/network/admin/tnsnames.ora
# Generated by Oracle configuration tools.
LISTENER_ORCLCDB =
  (ADDRESS = (PROTOCOL = TCP)(HOST = be807f28f5bd)(PORT = 1521))

ORCLCDB =
  (DESCRIPTION =
    (ADDRESS = (PROTOCOL = TCP)(HOST = be807f28f5bd)(PORT = 1521))
    (CONNECT_DATA =
      (SERVER = DEDICATED)
      (SERVICE_NAME = ORCLCDB)
    )
  )
```
## 変更
```
[oracle@be807f28f5bd /opt/oracle/product/19c/dbhome_1/network/admin]$echo "ORCLPDB@ = (DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = be807f28f5bd)(PORT = 1521)) (CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = ORCLPDB@)))" | parallel echo :::: - <(seq 12) | awk '{$NF="";RN=sprintf("%02d",NR);print "echo \x22"$0"\x22 | sed -E \x27s;@;"RN";g\x27"}' | sh >> /opt/oracle/product/19c/dbhome_1/network/admin/tnsnames.ora
```
## 変更後
```
[oracle@be807f28f5bd /opt/oracle/product/19c/dbhome_1/network/admin]$cat /opt/oracle/product/19c/dbhome_1/network/admin/tnsnames.ora# tnsnames.ora Network Configuration File: /opt/oracle/product/19c/dbhome_1/network/admin/tnsnames.ora
# Generated by Oracle configuration tools.
LISTENER_ORCLCDB =
  (ADDRESS = (PROTOCOL = TCP)(HOST = be807f28f5bd)(PORT = 1521))

ORCLCDB =
  (DESCRIPTION =
    (ADDRESS = (PROTOCOL = TCP)(HOST = be807f28f5bd)(PORT = 1521))
    (CONNECT_DATA =
      (SERVER = DEDICATED)
      (SERVICE_NAME = ORCLCDB)
    )
  )
ORCLPDB01 = (DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = be807f28f5bd)(PORT = 1521)) (CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = ORCLPDB01))) 
ORCLPDB02 = (DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = be807f28f5bd)(PORT = 1521)) (CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = ORCLPDB02))) 
ORCLPDB03 = (DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = be807f28f5bd)(PORT = 1521)) (CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = ORCLPDB03))) 
ORCLPDB04 = (DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = be807f28f5bd)(PORT = 1521)) (CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = ORCLPDB04))) 
ORCLPDB05 = (DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = be807f28f5bd)(PORT = 1521)) (CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = ORCLPDB05))) 
ORCLPDB06 = (DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = be807f28f5bd)(PORT = 1521)) (CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = ORCLPDB06))) 
ORCLPDB07 = (DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = be807f28f5bd)(PORT = 1521)) (CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = ORCLPDB07))) 
ORCLPDB08 = (DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = be807f28f5bd)(PORT = 1521)) (CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = ORCLPDB08))) 
ORCLPDB09 = (DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = be807f28f5bd)(PORT = 1521)) (CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = ORCLPDB09))) 
ORCLPDB10 = (DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = be807f28f5bd)(PORT = 1521)) (CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = ORCLPDB10))) 
ORCLPDB11 = (DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = be807f28f5bd)(PORT = 1521)) (CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = ORCLPDB11))) 
ORCLPDB12 = (DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = be807f28f5bd)(PORT = 1521)) (CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = ORCLPDB12))) 
```

# /opt/oracle/product/19c/dbhome_1/network/admin/tnsnames.oraの作成後、リスナーの再起動
停止してから起動する。起動直後はサービス登録されていないので、1分程まつ。
## 停止
```
[oracle@be807f28f5bd ~]$lsnrctl stop

LSNRCTL for Linux: Version 19.0.0.0.0 - Production on 11-SEP-2019 01:38:19

Copyright (c) 1991, 2019, Oracle.  All rights reserved.

Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=be807f28f5bd)(PORT=1521)))
The command completed successfully
```
## 起動
```
[oracle@be807f28f5bd ~]$lsnrctl start

LSNRCTL for Linux: Version 19.0.0.0.0 - Production on 11-SEP-2019 01:38:24

Copyright (c) 1991, 2019, Oracle.  All rights reserved.

Starting /opt/oracle/product/19c/dbhome_1/bin/tnslsnr: please wait...

TNSLSNR for Linux: Version 19.0.0.0.0 - Production
System parameter file is /opt/oracle/product/19c/dbhome_1/network/admin/listener.ora
Log messages written to /opt/oracle/diag/tnslsnr/be807f28f5bd/listener/alert/log.xml
Listening on: (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=be807f28f5bd)(PORT=1521)))
Listening on: (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=EXTPROC1521)))

Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=be807f28f5bd)(PORT=1521)))
STATUS of the LISTENER
------------------------
Alias                     LISTENER
Version                   TNSLSNR for Linux: Version 19.0.0.0.0 - Production
Start Date                11-SEP-2019 01:38:24
Uptime                    0 days 0 hr. 0 min. 0 sec
Trace Level               off
Security                  ON: Local OS Authentication
SNMP                      OFF
Listener Parameter File   /opt/oracle/product/19c/dbhome_1/network/admin/listener.ora
Listener Log File         /opt/oracle/diag/tnslsnr/be807f28f5bd/listener/alert/log.xml
Listening Endpoints Summary...
  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=be807f28f5bd)(PORT=1521)))
  (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=EXTPROC1521)))
The listener supports no services
The command completed successfully
```
## 確認
```
[oracle@be807f28f5bd ~]$lsnrctl status

LSNRCTL for Linux: Version 19.0.0.0.0 - Production on 11-SEP-2019 01:40:02

Copyright (c) 1991, 2019, Oracle.  All rights reserved.

Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=be807f28f5bd)(PORT=1521)))
STATUS of the LISTENER
------------------------
Alias                     LISTENER
Version                   TNSLSNR for Linux: Version 19.0.0.0.0 - Production
Start Date                11-SEP-2019 01:38:24
Uptime                    0 days 0 hr. 1 min. 38 sec
Trace Level               off
Security                  ON: Local OS Authentication
SNMP                      OFF
Listener Parameter File   /opt/oracle/product/19c/dbhome_1/network/admin/listener.ora
Listener Log File         /opt/oracle/diag/tnslsnr/be807f28f5bd/listener/alert/log.xml
Listening Endpoints Summary...
  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=be807f28f5bd)(PORT=1521)))
  (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=EXTPROC1521)))
  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcps)(HOST=be807f28f5bd)(PORT=5500))(Security=(my_wallet_directory=/opt/oracle/admin/ORCLCDB/xdb_wallet))(Presentation=HTTP)(Session=RAW))
Services Summary...
Service "9234d044e49e6e8ae053020011ac6424" has 1 instance(s).
  Instance "ORCLCDB", status READY, has 1 handler(s) for this service...
Service "9234d044e4a16e8ae053020011ac6424" has 1 instance(s).
  Instance "ORCLCDB", status READY, has 1 handler(s) for this service...
Service "9234d044e4a46e8ae053020011ac6424" has 1 instance(s).
  Instance "ORCLCDB", status READY, has 1 handler(s) for this service...
Service "9234d044e4a76e8ae053020011ac6424" has 1 instance(s).
  Instance "ORCLCDB", status READY, has 1 handler(s) for this service...
Service "9234d044e4aa6e8ae053020011ac6424" has 1 instance(s).
  Instance "ORCLCDB", status READY, has 1 handler(s) for this service...
Service "9234d044e4ad6e8ae053020011ac6424" has 1 instance(s).
  Instance "ORCLCDB", status READY, has 1 handler(s) for this service...
Service "9234d044e4b06e8ae053020011ac6424" has 1 instance(s).
  Instance "ORCLCDB", status READY, has 1 handler(s) for this service...
Service "9234d044e4b36e8ae053020011ac6424" has 1 instance(s).
  Instance "ORCLCDB", status READY, has 1 handler(s) for this service...
Service "9234d044e4b66e8ae053020011ac6424" has 1 instance(s).
  Instance "ORCLCDB", status READY, has 1 handler(s) for this service...
Service "9234d044e4b96e8ae053020011ac6424" has 1 instance(s).
  Instance "ORCLCDB", status READY, has 1 handler(s) for this service...
Service "9234d044e4bc6e8ae053020011ac6424" has 1 instance(s).
  Instance "ORCLCDB", status READY, has 1 handler(s) for this service...
Service "9234d044e4bf6e8ae053020011ac6424" has 1 instance(s).
  Instance "ORCLCDB", status READY, has 1 handler(s) for this service...
Service "ORCLCDB" has 1 instance(s).
  Instance "ORCLCDB", status READY, has 1 handler(s) for this service...
Service "ORCLCDBXDB" has 1 instance(s).
  Instance "ORCLCDB", status READY, has 1 handler(s) for this service...
Service "orclpdb01" has 1 instance(s).
  Instance "ORCLCDB", status READY, has 1 handler(s) for this service...
Service "orclpdb02" has 1 instance(s).
  Instance "ORCLCDB", status READY, has 1 handler(s) for this service...
Service "orclpdb03" has 1 instance(s).
  Instance "ORCLCDB", status READY, has 1 handler(s) for this service...
Service "orclpdb04" has 1 instance(s).
  Instance "ORCLCDB", status READY, has 1 handler(s) for this service...
Service "orclpdb05" has 1 instance(s).
  Instance "ORCLCDB", status READY, has 1 handler(s) for this service...
Service "orclpdb06" has 1 instance(s).
  Instance "ORCLCDB", status READY, has 1 handler(s) for this service...
Service "orclpdb07" has 1 instance(s).
  Instance "ORCLCDB", status READY, has 1 handler(s) for this service...
Service "orclpdb08" has 1 instance(s).
  Instance "ORCLCDB", status READY, has 1 handler(s) for this service...
Service "orclpdb09" has 1 instance(s).
  Instance "ORCLCDB", status READY, has 1 handler(s) for this service...
Service "orclpdb10" has 1 instance(s).
  Instance "ORCLCDB", status READY, has 1 handler(s) for this service...
Service "orclpdb11" has 1 instance(s).
  Instance "ORCLCDB", status READY, has 1 handler(s) for this service...
Service "orclpdb12" has 1 instance(s).
  Instance "ORCLCDB", status READY, has 1 handler(s) for this service...
The command completed successfully
```

# sqlplusからも接続確認

## SYSユーザーでCDB接続

```
[oracle@be807f28f5bd ~]$sqlplus sys/ORACLE_PWD@ORCLCDB as sysdba

SQL*Plus: Release 19.0.0.0.0 - Production on Wed Sep 11 01:56:25 2019
Version 19.3.0.0.0

Copyright (c) 1982, 2019, Oracle.  All rights reserved.



Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.3.0.0.0
?????????
SQL> show pdbs;

    CON_ID CON_NAME			  OPEN MODE  RESTRICTED
---------- ------------------------------ ---------- ----------
	 2 PDB$SEED			  READ ONLY  NO
	 3 ORCLPDB01			  READ WRITE NO
	 4 ORCLPDB02			  READ WRITE NO
	 5 ORCLPDB03			  READ WRITE NO
	 6 ORCLPDB04			  READ WRITE NO
	 7 ORCLPDB05			  READ WRITE NO
	 8 ORCLPDB06			  READ WRITE NO
	 9 ORCLPDB07			  READ WRITE NO
	10 ORCLPDB08			  READ WRITE NO
	11 ORCLPDB09			  READ WRITE NO
	12 ORCLPDB10			  READ WRITE NO

    CON_ID CON_NAME			  OPEN MODE  RESTRICTED
---------- ------------------------------ ---------- ----------
	13 ORCLPDB11			  READ WRITE NO
	26 ORCLPDB12			  READ WRITE NO
SQL> show con_name;

CON_NAME
------------------------------
CDB$ROOT

```
## SYSユーザーでPDB接続
SYS系ユーザー以外のユーザーに表領域の割り当て等を行う際にログインする。
```
[oracle@be807f28f5bd ~]$sqlplus sys/ORACLE_PWD@ORCLPDB01 as sysdba

SQL*Plus: Release 19.0.0.0.0 - Production on Wed Sep 11 01:58:32 2019
Version 19.3.0.0.0

Copyright (c) 1982, 2019, Oracle.  All rights reserved.



Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.3.0.0.0
?????????
SQL> show con_name;

CON_NAME
------------------------------
ORCLPDB01
SQL> select banner_full from v$version;

BANNER_FULL
--------------------------------------------------------------------------------
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.3.0.0.0


SQL> Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.3.0.0.0?????????????
[oracle@be807f28f5bd ~]$sqlplus sys/ORACLE_PWD@ORCLPDB12 as sysdba

SQL*Plus: Release 19.0.0.0.0 - Production on Wed Sep 11 01:59:08 2019
Version 19.3.0.0.0

Copyright (c) 1982, 2019, Oracle.  All rights reserved.



Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.3.0.0.0
?????????
SQL> show con_name;

CON_NAME
------------------------------
ORCLPDB12
SQL> select banner_full from v$version;

BANNER_FULL
--------------------------------------------------------------------------------
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.3.0.0.0


SQL> Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.3.0.0.0?????????????

```
## SYS系ユーザー以外のユーザーでPDB接続
パスワードはplsql流した時に指定したものでログイン。
CDB接続した際のSYSユーザのパスワードとは異なる。
```
[oracle@be807f28f5bd ~]$sqlplus pdb01/oracle_pwd@ORCLPDB01

SQL*Plus: Release 19.0.0.0.0 - Production on Wed Sep 11 02:03:41 2019
Version 19.3.0.0.0

Copyright (c) 1982, 2019, Oracle.  All rights reserved.

??????????: ?  9?   11 2019 01:47:14 +09:00


Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.3.0.0.0
?????????
SQL> show con_name;

CON_NAME
------------------------------
ORCLPDB01
SQL> select banner_full from v$version;

BANNER_FULL
--------------------------------------------------------------------------------
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.3.0.0.0


SQL> Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.3.0.0.0?????????????
[oracle@be807f28f5bd ~]$sqlplus pdb12/oracle_pwd@ORCLPDB12

SQL*Plus: Release 19.0.0.0.0 - Production on Wed Sep 11 02:04:16 2019
Version 19.3.0.0.0

Copyright (c) 1982, 2019, Oracle.  All rights reserved.

??????????: ?  9?   11 2019 01:48:35 +09:00


Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.3.0.0.0
?????????
SQL> select banner_full from v$version;

BANNER_FULL
--------------------------------------------------------------------------------
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.3.0.0.0


SQL> Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.3.0.0.0?????????????
```

# 物理ファイルについて

ORACLE_SIDに指定したインスタンス名のディレクトリがdbcaスクリプトより作成される。
その配下にPDB単位にディレクトリが作成されている。
データベースの停止、削除後も残っているが、その作業後、バックアップ等をしなければ、リムしてもよいとおもわれ。
```
[oracle@be807f28f5bd /]$sudo find / -name "*pdb*" | grep oracle | grep ORCLCDB
/opt/oracle/oradata/ORCLCDB/pdb12
/opt/oracle/oradata/ORCLCDB/pdb03
/opt/oracle/oradata/ORCLCDB/pdbseed
/opt/oracle/oradata/ORCLCDB/pdb8
/opt/oracle/oradata/ORCLCDB/pdb4
/opt/oracle/oradata/ORCLCDB/pdb7
/opt/oracle/oradata/ORCLCDB/pdb9
/opt/oracle/oradata/ORCLCDB/pdb2
/opt/oracle/oradata/ORCLCDB/pdb6
/opt/oracle/oradata/ORCLCDB/pdb5
/opt/oracle/oradata/ORCLCDB/pdb04
/opt/oracle/oradata/ORCLCDB/pdb10
/opt/oracle/oradata/ORCLCDB/pdb3
/opt/oracle/oradata/ORCLCDB/pdb06
/opt/oracle/oradata/ORCLCDB/pdb05
/opt/oracle/oradata/ORCLCDB/pdb02
/opt/oracle/oradata/ORCLCDB/pdb11
/opt/oracle/oradata/ORCLCDB/pdb07
/opt/oracle/oradata/ORCLCDB/pdb1
/opt/oracle/oradata/ORCLCDB/pdb08
/opt/oracle/oradata/ORCLCDB/pdb09
/opt/oracle/oradata/ORCLCDB/pdb01

```

# sqlclでも接続確認
?クエリパラメータはなぜか標準出力に吐かれない。
標準入力で与える場合は標準出力に吐かれる。
SYSユーザーの「as sysdba付与して接続」がアンドキュメント。たぶん。
```
[root@be807f28f5bd /]$sql --version
GNU sql 20190822
Copyright (C) 2009,2010,2011,2012,2013,2014,2015,2016,2017
Ole Tange and Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
GNU sql comes with no warranty.

Web site: http://www.gnu.org/software/sql

When using GNU sql for a publication please cite:

O. Tange (2011): GNU SQL - A Command Line Tool for Accessing Different
Databases Using DBURLs, ;login: The USENIX Magazine, April 2011:29-32.
```
## SYSユーザー以外でPDB接続
```
[oracle@be807f28f5bd ~]$man sql | grep oracle
        sql:oracle://scott:tiger@ora.example.com/xe
       Currently supported vendors: MySQL (mysql), MySQL with SSL (mysqls, mysqlssl), Oracle (oracle, ora), PostgreSQL (postgresql, pg, pgsql, postgres), PostgreSQL with SSL
       sql sql:oracle://scott:tiger@ora.example.com/xe
[oracle@be807f28f5bd ~]$man sql | grep ?
       dburl    A DBURL has the following syntax: [sql:]vendor:// [[user][:password]@][host][:port]/[database][?sqlquery]
       A DBURL has the following syntax: [sql:]vendor:// [[user][:password]@][host][:port]/[database][?sqlquery]
        sql:sqlite2:////tmp/db.sqlite?SELECT * FROM foo;
        sqlite3:///../db.sqlite3?SELECT%20*%20FROM%20foo;
        :query  sqlite:////tmp/db.sqlite?SELECT * FROM foo;
[oracle@be807f28f5bd ~]$sql sql:oracle://pdb12:oracle_pwd@localhost/ORCLPDB12

SQL*Plus: Release 19.0.0.0.0 - Production on Wed Sep 11 02:20:39 2019
Version 19.3.0.0.0

Copyright (c) 1982, 2019, Oracle.  All rights reserved.

??????????: ?  9?   11 2019 02:19:36 +09:00


Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.3.0.0.0
?????????
SQL> select banner_full from v$version;

BANNER_FULL
----------------------------------------------------------------------------------------------------------------------------------------------------------------
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production

SQL> Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.3.0.0.0?????????????
[oracle@be807f28f5bd ~]$sql sql:oracle://pdb01:oracle_pwd@localhost/ORCLPDB01?select banner_full from v$version;

[oracle@be807f28f5bd /]$echo "select banner_full from v\$version;" | sql sql:oracle://pdb01:oracle_pwd@localhost/ORCLPDB01

BANNER_FULL
----------------------------------------------------------------------------------------------------------------------------------------------------------------
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production


```

# Rライブラリ
ここらへんRstudioでいじってみてもおもろそう
以下を参考に。
[超高速な機械学習を Oracle Database で実現！](https://www.slideshare.net/oracle4engineer/hikalab-20171026)
```
[root@be807f28f5bd /opt/oracle/product/19c/dbhome_1/R]$pwd
/opt/oracle/product/19c/dbhome_1/R
[root@be807f28f5bd /opt/oracle/product/19c/dbhome_1/R]$ll
total 12
drwxr-xr-x. 15 oracle oinstall 4096  9月  9 22:11 library
drwxr-xr-x.  5 oracle oinstall 4096  9月  9 22:11 migration
drwxr-xr-x.  2 oracle oinstall 4096  9月  9 22:11 server
[root@be807f28f5bd /opt/oracle/product/19c/dbhome_1/R]$find . -name "*ja*"
./library/OREdm/doc/man/ja
./library/ORExml/doc/man/ja
./library/OREbase/doc/man/ja
./library/OREmodels/doc/man/ja
./library/ORE/doc/man/ja
./library/OREgraphics/doc/man/ja
./library/OREembed/doc/man/ja
./library/OREeda/doc/man/ja
./library/OREstats/doc/man/ja
./library/OREpredict/doc/man/ja
```

# 初期環境準備

```
DROP USER pdb01;
CREATE TABLESPACE USERS DATAFILE '/opt/oracle/oradata/ORCLCDB/pdb01/users01.dbf' SIZE 100M AUTOEXTEND ON NEXT 500K MAXSIZE UNLIMITED;
CREATE USER pdb01 IDENTIFIED BY "ORACLE_PWD" DEFAULT TABLESPACE USERS TEMPORARY TABLESPACE temp;
GRANT dba TO pdb01;
GRANT UNLIMITED TABLESPACE TO pdb01;
```

# 参考文献
```
https://www.sql-dbtips.com/architecture/orapwd/
https://oracle-base.com/articles/19c/oracle-db-19c-rpm-installation-on-oracle-linux-7
https://github.com/oraclebase/dockerfiles/tree/master/database/ol7_19
https://qiita.com/s-sasaki/items/cb768bd00d3588f494d4#%E6%9C%AA%E8%A7%A3%E6%B1%BA
https://qiita.com/manymanyuni/items/ee2a3b9032750fdf5d72#%E3%83%AC%E3%82%B9%E3%83%9D%E3%83%B3%E3%82%B9%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB
http://tamasaban.blog.fc2.com/blog-entry-40.html
https://docs.oracle.com/en/database/oracle/oracle-database/19/ladbi/running-rpm-packages-to-install-oracle-database.html#GUID-BB7C11E3-D385-4A2F-9EAF-75F4F0AACF02
https://qiita.com/mon_tu/items/6726524e738071afb7a7
https://heavywatal.github.io/cxx/gcc.html
https://orablogs-jp.blogspot.com/2016/07/creating-and-oracle-database-docker.html
https://qiita.com/yahihi/items/351018be17585f28926b
http://sugimura.cc/pukiwiki/?%E6%8A%80%E8%A1%93%E6%96%87%E6%9B%B8%2FOracle%2F11g%2F%E3%83%A1%E3%83%A2%E3%83%AA%E3%81%AE%E8%A8%AD%E5%AE%9A
```
